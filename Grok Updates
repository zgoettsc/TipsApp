.onAppear {
    if !hasAppeared {
        hasAppeared = true
        NSLog("ContentView onAppear - Initial load at %@", String(describing: Date()))
        appData.reloadCachedData()
        appData.checkAndResetIfNeeded()
        initializeCollapsedState()
        checkSetupNeeded()
        checkNotificationPermissions()
        if let endDate = appData.treatmentTimerEnd, endDate > Date() {
            NSLog("Restoring timer on appear: endDate = %@, remaining = %f", String(describing: endDate), endDate.timeIntervalSinceNow)
            resumeTreatmentTimer()
        } else {
            NSLog("No active timer to restore on appear: treatmentTimerEnd = %@", String(describing: appData.treatmentTimerEnd))
        }
    }
}
